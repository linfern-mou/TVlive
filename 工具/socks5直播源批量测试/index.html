<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOCKS5代理直播源测试工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-broadcast-tower"></i> SOCKS5代理直播源测试工具</h1>
            <p class="subtitle">测试直播源通过SOCKS5代理的可用性，支持频道名+分组格式、TXT导入及测试报告导出</p>
        </header>
        
        <main>
            <div class="card">
                <h2 class="card-title"><i class="fas fa-server"></i> SOCKS5代理配置</h2>
                <div class="form-group">
                    <label for="proxy">代理地址（主机:端口）</label>
                    <input type="text" id="proxy" placeholder="例如: 127.0.0.1:1080">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="use-auth">
                    <label for="use-auth">使用代理身份验证</label>
                </div>
                
                <div id="auth-fields" class="auth-fields">
                    <div class="input-row">
                        <div class="form-group">
                            <label for="proxy-username">用户名 (可选)</label>
                            <input type="text" id="proxy-username" placeholder="如果代理需要验证">
                        </div>
                        <div class="form-group">
                            <label for="proxy-password">密码 (可选)</label>
                            <input type="password" id="proxy-password" placeholder="如果代理需要验证">
                        </div>
                    </div>
                </div>

                <div class="checkbox-group" style="margin-top: 10px;">
                    <input type="checkbox" id="force-ipv4" checked>
                    <label for="force-ipv4">强制使用IPv4（解决IPv6重定向问题）</label>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-list-ol"></i> 批量频道配置</h2>
                <div class="form-group">
                    <label for="batch-urls">频道列表（支持 #genre# 分组和 "频道名,URL" 格式）</label>
                    <textarea id="batch-urls" rows="8" class="batch-textarea" placeholder="央视,#genre#
CCTV1,http://tvgslb.hn.chinamobile.com:8089/180000001002/00000001000000000007000000001243/main.m3u8
卫视,#genre#
湖南卫视,http://tvgslb.hn.chinamobile.com:8089/180000001002/00000001000000000010000000040382/main.m3u8

# 也支持纯URL格式（没有频道名）
http://tvgslb.hn.chinamobile.com:8089/180000001002/00000001000000000002000000113182/main.m3u8
http://tvgslb.hn.chinamobile.com:8089/180000001002/00000001000000000007000000001249/main.m3u8"></textarea>
                    <p style="margin-top: 6px; font-size: 0.85rem; color: #94a3b8;">
                        支持txt直播源列表格式。系统将测试每个URL的状态码，并对状态码200的M3U8文件进行内容验证。
                    </p>
                </div>
                
                <div class="batch-controls">
                    <label class="btn btn-clear">
                        <i class="fas fa-folder-open"></i> <span>导入TXT列表</span>
                        <input type="file" id="import-txt-file" accept=".txt,text/plain" style="display: none;">
                    </label>
                    
                    <button id="load-example-urls" class="btn btn-clear">
                        <i class="fas fa-file-import"></i> <span>加载示例</span>
                    </button>
                    
                    <button id="clear-urls" class="btn btn-clear">
                        <i class="fas fa-trash-alt"></i> <span>清空</span>
                    </button>
                    
                    <div id="url-count">频道: 0</div>
                </div>
                
                <div class="form-group">
                    <label for="custom-ua">自定义 User-Agent（可选）</label>
                    <div class="input-row">
                        <div class="form-group" style="flex: 2;">
                            <input type="text" id="custom-ua" placeholder="手动输入自定义User-Agent或从下方选择">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <select id="ua-preset" class="ua-preset">
                                <option value="">选择预置UA</option>
                                <option value="okhttp/3.15">okhttp/3.15</option>
                                <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1">Safari (iPhone)</option>
                                <option value="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0">Firefox (Windows)</option>
                                <option value="Mozilla/5.0 (Linux; Android 10; SM-G973F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Mobile Safari/537.36">Chrome (Android)</option>
                                <option value="VLC/3.0.18 LibVLC/3.0.18">VLC播放器</option>
                                <option value="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36">Chrome (Windows)</option>
                                <option value="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15">Safari (Mac)</option>
                                <option value="Kodi/20.2 (Windows NT 10.0; Win64; x64) App_Bitness/64 Version/20.2-Git:20230521-7a5e4c5">Kodi播放器</option>
                            </select>
                        </div>
                    </div>
                </div>
                

            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-play-circle"></i> 测试设置</h2>
                <div class="checkbox-group" style="margin-bottom: 15px;">
                    <input type="checkbox" id="stop-on-first-failure" checked>
                    <label for="stop-on-first-failure">遇到第一个失败时停止（代理连接失败时）</label>
                </div>
                
                <div class="checkbox-group" style="margin-bottom: 15px;">
                    <input type="checkbox" id="test-only-m3u8" checked>
                    <label for="test-only-m3u8">仅测试M3U8文件（跳过非M3U8 URL）</label>
                </div>

                <div class="checkbox-group" style="margin-bottom: 20px;">
                    <input type="checkbox" id="test-proxy-first">
                    <label for="test-proxy-first">先测试代理连通性（确保代理可用）</label>
                </div>
                
                <div class="btn-group">
                    <button id="batch-test-btn" class="btn btn-batch">
                        <i class="fas fa-play-circle"></i> 开始测试
                    </button>
                    <button id="stop-batch-test" class="btn btn-clear" style="display: none;">
                        <i class="fas fa-stop-circle"></i> 停止测试
                    </button>
                </div>

                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="card" id="test-log-card" style="display: none;">
    <h2 class="card-title"><i class="fas fa-clipboard-list"></i> 测试日志（实时）</h2>
    
    <div class="form-group" style="margin-bottom: 10px;">
        <label for="historical-logs">查看历史日志</label>
        <div class="input-row">
            <select id="historical-logs" class="ua-preset">
                <option value="current">当前测试</option>
            </select>
            <div class="button-container">
                <button id="load-historical-log" class="btn btn-clear">
                    <i class="fas fa-history"></i> <span>加载日志</span>
                </button>
                <button id="clear-historical-logs" class="btn btn-clear">
                    <i class="fas fa-trash-alt"></i> <span>清空历史</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="log-box" class="log-box">
        <div class="log-entry">
            <span class="log-time">[系统]</span>
            <span class="log-info">开始测试后，日志将在这里实时显示...</span>
        </div>
    </div>
    <div class="log-actions">
        <button id="export-log-btn" class="btn btn-clear">
            <i class="fas fa-download"></i> <span>导出日志</span>
        </button>
        <button id="clear-log-btn" class="btn btn-clear">
            <i class="fas fa-trash-alt"></i> <span>清除日志</span>
        </button>
        <button id="show-realtime-log" class="btn btn-clear">
            <i class="fas fa-play-circle"></i> <span>返回实时</span>
        </button>
    </div>
</div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-history"></i> 测试记录</h2>
                <div class="test-records-container">
                    <p style="margin-bottom: 15px; color: #b0b0d0; font-size: 0.8rem;">
                        自动保存最近的测试记录，点击记录可快速填充配置。
                    </p>
                    
                    <div class="records-controls">
                        <button id="clear-records-btn" class="btn btn-clear">
                            <i class="fas fa-trash-alt"></i> <span>清除记录</span>
                        </button>
                        <div id="records-count">记录: 0/20</div>
                    </div>
                    
                    <div class="records-list" id="records-list">
                        <div class="record-empty">
                            <i class="fas fa-history"></i>
                            <p>暂无测试记录</p>
                            <p style="font-size: 0.8rem; margin-top: 5px;">完成测试后将自动保存记录</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-bar"></i> 测试统计</h2>
                <div class="batch-stats">
                    <div class="stat-item">
                        <div id="total-urls-stat" class="stat-value">0</div>
                        <div class="stat-label">总频道数</div>
                    </div>
                    <div class="stat-item">
                        <div id="completed-urls-stat" class="stat-value">0</div>
                        <div class="stat-label">已完成</div>
                    </div>
                    <div class="stat-item">
                        <div id="success-urls-stat" class="stat-value">0</div>
                        <div class="stat-label">成功</div>
                    </div>
                    <div class="stat-item">
                        <div id="failed-urls-stat" class="stat-value">0</div>
                        <div class="stat-label">失败</div>
                    </div>
                    <div class="stat-item">
                        <div id="valid-m3u8-stat" class="stat-value">0</div>
                        <div class="stat-label">有效M3U8</div>
                    </div>
                    <div class="stat-item">
                        <div id="success-rate-stat" class="stat-value">0%</div>
                        <div class="stat-label">成功率</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-table"></i> 测试结果</h2>
                <div class="batch-results">
                    <table id="batch-result-table" class="batch-result-table">
                        <thead>
                            <tr>
                                <th width="40">#</th>
                                <th>频道名称</th>
                                <th width="80">状态码</th>
                                <th width="100">响应时间</th>
                                <th width="80">M3U8</th>
                                <th width="80">有效性</th>
                                <th width="120">详细信息</th>
                            </tr>
                        </thead>
                        <tbody id="batch-result-body">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px; color: #94a3b8;">
                                    尚未开始测试，请配置频道并点击"开始测试"按钮
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="batch-actions" style="margin-top: 15px;">
                    <button id="export-valid-report-btn" class="btn btn-batch">
                        <i class="fas fa-file-alt"></i> <span>导出测试报告</span>
                    </button>
                    <button id="clear-results-btn" class="btn btn-clear">
                        <i class="fas fa-trash-alt"></i> <span>清除结果</span>
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-info-circle"></i> 使用说明</h2>
                <div style="padding: 8px 0;">
                    <h3 style="color: #4cc9f0; margin-bottom: 8px; font-size: 1.1rem;">新增功能：</h3>
                    <ul style="padding-left: 18px; margin-bottom: 15px; font-size: 0.95rem;">
                        <li>支持直接粘贴或导入带频道名的源列表（格式：频道名,URL）</li>
                        <li>支持 #genre# 分组，测试报告会保留完整分组结构</li>
                        <li>点击"导入TXT文件"可直接加载本地源文件</li>
                        <li>测试完成后可点击"导出测试报告"生成标准TXT报告（有效/超时/无效三类）</li>
                    </ul>
                    
                                        <h3 style="color: #4cc9f0; margin-bottom: 8px; font-size: 1.1rem;">M3U8有效性验证：</h3>
                    <ul style="padding-left: 18px; margin-bottom: 15px; font-size: 0.95rem;">
                        <li>检查文件头部是否为 #EXTM3U</li>
                        <li>检查是否包含至少一个 #EXTINF 标签</li>
                        <li>检查是否包含有效的视频段链接（.ts, .m4s等）</li>
                        <li>分析M3U8的详细信息（时长、比特率、分段数量等）</li>
                    </ul>
                    
                    <h3 style="color: #4cc9f0; margin-bottom: 8px; font-size: 1.1rem;">测试流程：</h3>
                    <ol style="padding-left: 18px; margin-bottom: 15px; font-size: 0.95rem;">
                        <li>在"批量URL配置"中填写多个URL（一行一个）</li>
                        <li>配置代理服务器信息</li>
                        <li>勾选"强制使用IPv4"可以解决某些服务器IPv6重定向问题</li>
                        <li>点击"开始测试"按钮</li>
                        <li>查看实时日志了解测试进度</li>
                        <li>测试完成后会自动保存测试记录</li>
                    </ol>

                    <h3 style="color: #4cc9f0; margin-bottom: 8px; font-size: 1.1rem;">测试记录功能：</h3>
                    <ul style="padding-left: 18px; margin-bottom: 15px; font-size: 0.95rem;">
                        <li>每次测试完成后会自动保存配置和测试结果</li>
                        <li>点击历史记录可快速填充到输入框</li>
                        <li>相同的配置会自动更新，不会重复保存</li>
                        <li>最多保存20条记录，显示最近5条</li>
                        <li>点击记录右侧的×按钮可删除单条记录</li>
                    </ul>

                    <h3 style="color: #4cc9f0; margin-bottom: 8px; font-size: 1.1rem;">注意事项：</h3>
                    <ul style="padding-left: 18px; font-size: 0.95rem;">
                        <li>只测试状态码为200的URL，其他状态码视为失败</li>
                        <li>对于非M3U8文件或无效M3U8，系统会标记为无效</li>
                        <li>测试速度取决于代理服务器网络状况和URL数量</li>
                        <li>测试记录保存在浏览器本地，清除浏览器数据会丢失记录</li>
                        <li>测试过程中，实时日志会显示在"开始测试"按钮下方</li>
                    </ul>
                    
                </div>
            </div>
        </main>
        
        <footer>
            <p>SOCKS5代理直播源测试工具 &copy; 2025 | 支持频道名、分组、TXT导入及测试报告导出</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">需要PHP 7.0+ 和 cURL、sockets扩展支持</p>
        </footer>
    </div>
    
    <script src="script.js"></script>
</body>
</html>